<!DOCTYPE html>
<html>
<head>
    <title>three.js css3d - periodic table</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="main.css">
    <style>
        a {
            color: #8ff;
        }
        
        #menu {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
        }
        
        .element {
            width: 140px; 
            height: 180px; 
            box-shadow: 0px 0px 12px rgba(0,255,255,0.5);
            border: 1px solid rgba(127,255,255,0.25);
            font-family: Helvetica, sans-serif;
            text-align: center;
            line-height: normal;
            cursor: default;
            
            /* --- CENTER LAYOUT --- */
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center;     
            position: relative; 
            box-sizing: border-box; 
        }
        
        .element:hover {
            box-shadow: 0px 0px 12px rgba(0,255,255,0.75);
            border: 1px solid rgba(127,255,255,0.75);
        }

        /* --- CORNER DATA --- */
        .element .country {
            position: absolute;
            top: 10px;
            left: 20px; 
            font-size: 10px;
            font-weight: bold;
            color: rgba(127,255,255,0.75);
            text-transform: uppercase;
        }

        .element .age {
            position: absolute;
            top: 10px;
            right: 20px; 
            font-size: 10px;
            font-weight: bold;
            color: rgba(127,255,255,0.75);
        }

        /* --- CENTER STACK --- */
        .element .pic {
            width: 100px;
            height: 100px; 
            border-radius: 0px; 
            object-fit: cover;
            border: 2px solid rgba(127,255,255,0.5);
            background-color: #000;
            margin-top: 15px; 
            margin-bottom: 5px; 
        }

        .element .name {
            font-size: 12px; 
            font-weight: bold;
            color: rgba(255,255,255,0.9);
            text-shadow: 0 0 10px rgba(0,255,255,0.5);
            margin-bottom: 2px; 
            width: 100px; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .element .interest {
            font-size: 11px; 
            color: rgba(255,255,255,0.9); 
            margin-top: 0px;
        }
        
        button {
            color: rgba(127,255,255,0.75);
            background: transparent;
            outline: 1px solid rgba(127,255,255,0.75);
            border: 0px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: rgba(0,255,255,0.5);
        }
        
        button:active {
            color: #000000;
            background-color: rgba(0,255,255,0.75);
        }
    </style>
</head>
<body>

    <div id="info"><a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> css3d - personnel card layout</div>
    <div id="container"></div>
    <div id="menu">
        <button id="table">TABLE</button>
        <button id="sphere">SPHERE</button>
        <button id="helix">HELIX</button>
        <button id="grid">GRID</button>
        <button id="tetrahedron">TETRAHEDRON</button>
    </div>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.164.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.0/examples/jsm/"
            }
        }
    </script>
    
    <script type="module">

        import * as THREE from 'three';
        import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';
        import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
        import TWEEN from 'https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.esm.js';

        
        let peopleData = [];
        let camera, scene, renderer;
        let controls;
        
        const objects = [];
        // ADDED 'tetrahedron' TO TARGETS
        const targets = { table: [], sphere: [], helix: [], grid: [], tetrahedron: [] };
        
        async function loadData() {
            const API_URL = "https://script.google.com/macros/s/AKfycbwCONwNuahsiaKLNOAd5izbnzijmHhZ8zh32kYomd94d93yFoCrS_dgm5svu_o78g/exec";
            const response = await fetch(API_URL);
            const data = await response.json();
            
            console.log("Loaded people:", data);
            
            peopleData = data;
            init();     
            animate();
        }
                
        function init() {

            camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 10000 );
            camera.position.z = 3000;
            
            scene = new THREE.Scene();
            
            // --- CREATE TILES ---
            for (let i = 0; i < peopleData.length; i++) {
                const person = peopleData[i];

                const element = document.createElement('div');
                element.className = 'element';

                function getColor(nw) {
                    if (nw > 200000) return "rgba(58,159,72,0.6)"; // Green
                    if (nw > 100000) return "rgba(253,202,53,0.6)"; // Yellow
                    return "rgba(239,48,34,0.6)"; // Red
                }

                const netWorth = Number(String(person["Net Worth"]).replace(/[^0-9.-]+/g, ""));
                element.style.backgroundColor = getColor(netWorth);

                // Country
                const country = document.createElement('div');
                country.className = 'country';
                country.textContent = person.Country;
                element.appendChild(country);

                // Age
                const age = document.createElement('div');
                age.className = 'age';
                age.textContent = person.Age;
                element.appendChild(age);

                // Picture
                const img = document.createElement('img');
                img.className = 'pic';
                img.src = person.Photo; 
                element.appendChild(img);

                // Name
                const name = document.createElement('div');
                name.className = 'name';
                name.textContent = person.Name;
                element.appendChild(name);

                // Interest
                const interest = document.createElement('div');
                interest.className = 'interest';
                interest.textContent = person.Interest || "Investing"; 
                element.appendChild(interest);

                // 3D Object
                const objectCSS = new CSS3DObject(element);
                objectCSS.position.x = Math.random() * 4000 - 2000;
                objectCSS.position.y = Math.random() * 4000 - 2000;
                objectCSS.position.z = Math.random() * 4000 - 2000;
                
                scene.add(objectCSS);
                objects.push(objectCSS);
            }

            // --- TABLE LAYOUT ---
            const cols = 20; 
            const rows = 10; 
            const spacingX = 160; 
            const spacingY = 200; 

            for (let i = 0; i < peopleData.length; i++) {
                const col = i % cols;         
                const row = Math.floor(i / cols); 

                const object = new THREE.Object3D();
                object.position.x = (col * spacingX) - ((cols-1)/2 * spacingX); 
                object.position.y = -(row * spacingY) + ((rows-1)/2 * spacingY); 
                targets.table.push(object);
            }

            // --- SPHERE LAYOUT ---
            const vector = new THREE.Vector3();
            for ( let i = 0, l = objects.length; i < l; i ++ ) {
                const phi = Math.acos( - 1 + ( 2 * i ) / l );
                const theta = Math.sqrt( l * Math.PI ) * phi;
                const object = new THREE.Object3D();
                object.position.setFromSphericalCoords( 800, phi, theta );
                vector.copy( object.position ).multiplyScalar( 2 );
                object.lookAt( vector );
                targets.sphere.push( object );
            }
            
            // --- HELIX LAYOUT ---
            for ( let i = 0, l = objects.length; i < l; i ++ ) {
                const theta = i * 0.175 + Math.PI + ( i % 2 ) * Math.PI;
                const y = - ( i * 8 ) + 450;
                const object = new THREE.Object3D();
                object.position.setFromCylindricalCoords( 900, theta, y );
                vector.x = object.position.x * 2;
                vector.y = object.position.y;
                vector.z = object.position.z * 2;
                object.lookAt( vector );
                targets.helix.push( object );
            }
            
            // --- GRID LAYOUT ---
            for ( let i = 0; i < objects.length; i ++ ) {
                const object = new THREE.Object3D();
                object.position.x = ( ( i % 5 ) * 400 ) - 800;
                object.position.y = ( - ( Math.floor( i / 5 ) % 4 ) * 400 ) + 600;
                object.position.z = ( Math.floor( i / 20 ) ) * 1000 - 2000;
                targets.grid.push( object );
            }

            // --- TETRAHEDRON LAYOUT (FIXED ROTATION) ---
            let count = 0;
            let layer = 1; 
            
            while(count < objects.length) {
                for (let r = 0; r < layer; r++) {
                    for (let c = 0; c <= r; c++) {
                        if (count >= objects.length) break;

                        const object = new THREE.Object3D();
                        const spread = 180; 
                        
                        // Position logic remains the same (Pyramid Shape)
                        object.position.y = 800 - (layer * 160);
                        const zOffset = ((layer-1) * spread * 0.866) / 2;
                        object.position.z = (r * spread * 0.866) - zOffset;
                        const xOffset = (r * spread) / 2;
                        object.position.x = (c * spread) - xOffset;

                        // --- THE FIX ---
                        // Instead of looking outward, we lock the rotation to 0,0,0
                        // This makes them all face "Front" (towards the camera)
                        object.rotation.set(0, 0, 0); 

                        targets.tetrahedron.push(object);
                        count++;
                    }
                    if (count >= objects.length) break;
                }
                layer++;
            }
            
            // --- RENDERER & CONTROLS ---
            renderer = new CSS3DRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.getElementById( 'container' ).appendChild( renderer.domElement );
            
            controls = new TrackballControls( camera, renderer.domElement );
            controls.minDistance = 500;
            controls.maxDistance = 6000;
            controls.addEventListener( 'change', render );
            
            // --- BUTTON EVENTS ---
            const buttonTable = document.getElementById( 'table' );
            buttonTable.addEventListener( 'click', function () { transform( targets.table, 2000 ); } );
            
            const buttonSphere = document.getElementById( 'sphere' );
            buttonSphere.addEventListener( 'click', function () { transform( targets.sphere, 2000 ); } );
            
            const buttonHelix = document.getElementById( 'helix' );
            buttonHelix.addEventListener( 'click', function () { transform( targets.helix, 2000 ); } );
            
            const buttonGrid = document.getElementById( 'grid' );
            buttonGrid.addEventListener( 'click', function () { transform( targets.grid, 2000 ); } );

            // NEW BUTTON LISTENER
            const buttonTetra = document.getElementById( 'tetrahedron' );
            buttonTetra.addEventListener( 'click', function () { transform( targets.tetrahedron, 2000 ); } );
            
            transform( targets.table, 2000 );
            
            window.addEventListener( 'resize', onWindowResize );
        }
        
        function transform( targets, duration ) {
            TWEEN.removeAll();
            for ( let i = 0; i < objects.length; i ++ ) {
                const object = objects[ i ];
                const target = targets[ i ];
                new TWEEN.Tween( object.position )
                    .to( { x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration )
                    .easing( TWEEN.Easing.Exponential.InOut )
                    .start();
                new TWEEN.Tween( object.rotation )
                    .to( { x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration )
                    .easing( TWEEN.Easing.Exponential.InOut )
                    .start();
            }
            new TWEEN.Tween( this )
                .to( {}, duration * 2 )
                .onUpdate( render )
                .start();
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
            render();
        }
        
        function animate() {
            requestAnimationFrame( animate );
            TWEEN.update();
            controls.update();
        }
        
        function render() {
            renderer.render( scene, camera );
        }
        
        loadData();
        
    </script>
</body>
</html>