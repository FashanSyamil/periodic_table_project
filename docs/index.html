<!DOCTYPE html>
<html lang="en">
<head>
    <title>Personnel Data Visualization</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        /* --- GLOBAL & LOGIN STYLES --- */
        body {
            /* Start with Login Background */
            background-color: #f0f2f5; 
            font-family: 'Helvetica', sans-serif;
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
            transition: background-color 1s ease; /* Smooth fade to black */
        }

        /* The Login Container */
        #login-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Stays on top */
            background-color: #f0f2f5;
        }

        .login-card {
            background-color: #ffffff;
            padding: 40px 40px 60px 40px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 450px;
        }

        .login-card h2 {
            color: #333;
            font-size: 24px;
            font-weight: normal;
            margin: 0 0 10px 0;
        }

        .login-card p {
            color: #666;
            font-size: 14px;
            margin: 0 0 30px 0;
        }

        .g_id_signin {
            display: flex;
            justify-content: center;
        }

        /* --- 3D SCENE STYLES (Hidden initially) --- */
        #app-container {
            display: none; /* HIDDEN BY DEFAULT */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        a { color: #8ff; }

        #menu {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
        }

        .element {
            width: 140px; 
            height: 180px; 
            box-shadow: 0px 0px 12px rgba(0,255,255,0.5);
            border: 1px solid rgba(127,255,255,0.25);
            font-family: Helvetica, sans-serif;
            text-align: center;
            line-height: normal;
            cursor: default;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center;     
            position: relative; 
            box-sizing: border-box; 
        }

        .element:hover {
            box-shadow: 0px 0px 12px rgba(0,255,255,0.75);
            border: 1px solid rgba(127,255,255,0.75);
        }

        .element .country {
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 10px;
            font-weight: bold;
            color: rgba(127,255,255,0.75);
            text-transform: uppercase;
        }

        .element .age {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 10px;
            font-weight: bold;
            color: rgba(127,255,255,0.75);
        }

        .element .pic {
            width: 100px;
            height: 100px; 
            border-radius: 0px; 
            object-fit: cover;
            border: 2px solid rgba(127,255,255,0.5);
            background-color: #000;
            margin-top: 15px; 
            margin-bottom: 5px; 
        }

        .element .name {
            font-size: 12px; 
            font-weight: bold;
            color: rgba(255,255,255,0.9);
            text-shadow: 0 0 10px rgba(0,255,255,0.5);
            margin-bottom: 2px; 
            width: 100px; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .element .interest {
            font-size: 11px; 
            color: rgba(255,255,255,0.9); 
            margin-top: 0px;
        }

        button {
            color: rgba(127,255,255,0.75);
            background: transparent;
            outline: 1px solid rgba(127,255,255,0.75);
            border: 0px;
            padding: 5px 10px;
            cursor: pointer;
        }

        button:hover { background-color: rgba(0,255,255,0.5); }
        button:active { color: #000000; background-color: rgba(0,255,255,0.75); }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card">
            <h2>Welcome Back</h2>
            <p>Please sign in to access the visualization.</p>

            <div id="g_id_onload"
                 data-client_id="317330317490-4a2mh5gnhdrafmqrppkiut0ujva0h31u.apps.googleusercontent.com"
                 data-context="signin"
                 data-ux_mode="popup"
                 data-callback="onLoginSuccess"
                 data-auto_prompt="false">
            </div>

            <div class="g_id_signin"
                 data-type="standard"
                 data-shape="rectangular"
                 data-theme="filled_blue"
                 data-text="signin_with"
                 data-size="large"
                 data-logo_alignment="left"
                 data-width="250">
            </div>
        </div>
    </div>

    <div id="app-container">
        <div id="container"></div>
        <div id="menu">
            <button id="table">TABLE</button>
            <button id="sphere">SPHERE</button>
            <button id="helix">HELIX</button>
            <button id="grid">GRID</button>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.164.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.0/examples/jsm/"
            }
        }
    </script>
    
    <script type="module">
        import * as THREE from 'three';
        import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';
        import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
        import TWEEN from 'https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.esm.js';

        // --- 1. GLOBAL LOGIN HANDLER ---
        // We attach this to 'window' so the Google button can find it.
        window.onLoginSuccess = function(response) {
            console.log("Login Successful! Token:", response.credential);
            
            // A. Hide Login, Show App
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            
            // B. Change Background to Dark
            document.body.style.backgroundColor = '#050505';

            // C. Start the 3D Engine
            loadData(); 
        };

        // --- 2. THREE.JS LOGIC ---
        let peopleData = [];
        let camera, scene, renderer;
        let controls;
        
        const objects = [];
        const targets = { table: [], sphere: [], helix: [], grid: [] };
        
        async function loadData() {
            const API_URL = "https://script.google.com/macros/s/AKfycbwCONwNuahsiaKLNOAd5izbnzijmHhZ8zh32kYomd94d93yFoCrS_dgm5svu_o78g/exec";
            
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                console.log("Loaded people:", data);
                peopleData = data;
                init();     
                animate();
            } catch (error) {
                console.error("Error loading data:", error);
            }
        }
                
        function init() {
            camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 10000 );
            camera.position.z = 3000;
            
            scene = new THREE.Scene();
            
            // --- CREATE TILES ---
            for (let i = 0; i < peopleData.length; i++) {
                const person = peopleData[i];

                const element = document.createElement('div');
                element.className = 'element';

                function getColor(nw) {
                    if (nw > 200000) return "rgba(58,159,72,0.6)"; // Green
                    if (nw > 100000) return "rgba(253,202,53,0.6)"; // Yellow
                    return "rgba(239,48,34,0.6)"; // Red
                }

                const netWorth = Number(String(person["Net Worth"]).replace(/[^0-9.-]+/g, ""));
                element.style.backgroundColor = getColor(netWorth);

                // Country
                const country = document.createElement('div');
                country.className = 'country';
                country.textContent = person.Country;
                element.appendChild(country);

                // Age
                const age = document.createElement('div');
                age.className = 'age';
                age.textContent = person.Age;
                element.appendChild(age);

                // Picture
                const img = document.createElement('img');
                img.className = 'pic';
                img.src = person.Photo; 
                element.appendChild(img);

                // Name
                const name = document.createElement('div');
                name.className = 'name';
                name.textContent = person.Name;
                element.appendChild(name);

                // Interest
                const interest = document.createElement('div');
                interest.className = 'interest';
                interest.textContent = person.Interest || "Investing"; 
                element.appendChild(interest);

                // CSS3D Object
                const objectCSS = new CSS3DObject(element);
                objectCSS.position.x = Math.random() * 4000 - 2000;
                objectCSS.position.y = Math.random() * 4000 - 2000;
                objectCSS.position.z = Math.random() * 4000 - 2000;
                
                scene.add(objectCSS);
                objects.push(objectCSS);
            }

            // --- TABLE LAYOUT ---
            const cols = 20; 
            const rows = 10; 
            const spacingX = 160; 
            const spacingY = 200; 

            for (let i = 0; i < peopleData.length; i++) {
                const col = i % cols;         
                const row = Math.floor(i / cols); 

                const object = new THREE.Object3D();
                object.position.x = (col * spacingX) - ((cols-1)/2 * spacingX); 
                object.position.y = -(row * spacingY) + ((rows-1)/2 * spacingY); 
                targets.table.push(object);
            }

            // --- SPHERE LAYOUT ---
            const vector = new THREE.Vector3();
            for ( let i = 0, l = objects.length; i < l; i ++ ) {
                const phi = Math.acos( - 1 + ( 2 * i ) / l );
                const theta = Math.sqrt( l * Math.PI ) * phi;
                const object = new THREE.Object3D();
                object.position.setFromSphericalCoords( 800, phi, theta );
                vector.copy( object.position ).multiplyScalar( 2 );
                object.lookAt( vector );
                targets.sphere.push( object );
            }
            
            // --- DOUBLE HELIX LAYOUT ---
            for ( let i = 0, l = objects.length; i < l; i ++ ) {
                const theta = i * 0.175 + Math.PI + ( i % 2 ) * Math.PI;
                const y = - ( i * 8 ) + 450;
                const object = new THREE.Object3D();
                object.position.setFromCylindricalCoords( 900, theta, y );
                vector.x = object.position.x * 2;
                vector.y = object.position.y;
                vector.z = object.position.z * 2;
                object.lookAt( vector );
                targets.helix.push( object );
            }
            
            // --- GRID LAYOUT (5x4x10) ---
            for ( let i = 0; i < objects.length; i ++ ) {
                const object = new THREE.Object3D();
                object.position.x = ( ( i % 5 ) * 400 ) - 800;
                object.position.y = ( - ( Math.floor( i / 5 ) % 4 ) * 400 ) + 600;
                object.position.z = ( Math.floor( i / 20 ) ) * 1000 - 2000;
                targets.grid.push( object );
            }
            
            // --- RENDERER & CONTROLS ---
            renderer = new CSS3DRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.getElementById( 'container' ).appendChild( renderer.domElement );
            
            controls = new TrackballControls( camera, renderer.domElement );
            controls.minDistance = 500;
            controls.maxDistance = 6000;
            controls.addEventListener( 'change', render );
            
            // --- BUTTONS ---
            const buttonTable = document.getElementById( 'table' );
            buttonTable.addEventListener( 'click', function () { transform( targets.table, 2000 ); } );
            
            const buttonSphere = document.getElementById( 'sphere' );
            buttonSphere.addEventListener( 'click', function () { transform( targets.sphere, 2000 ); } );
            
            const buttonHelix = document.getElementById( 'helix' );
            buttonHelix.addEventListener( 'click', function () { transform( targets.helix, 2000 ); } );
            
            const buttonGrid = document.getElementById( 'grid' );
            buttonGrid.addEventListener( 'click', function () { transform( targets.grid, 2000 ); } );
            
            transform( targets.table, 2000 );
            
            window.addEventListener( 'resize', onWindowResize );
        }
        
        function transform( targets, duration ) {
            TWEEN.removeAll();
            for ( let i = 0; i < objects.length; i ++ ) {
                const object = objects[ i ];
                const target = targets[ i ];
                new TWEEN.Tween( object.position )
                    .to( { x: target.position.x, y: target.position.y, z: target.position.z }, Math.random() * duration + duration )
                    .easing( TWEEN.Easing.Exponential.InOut )
                    .start();
                new TWEEN.Tween( object.rotation )
                    .to( { x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration )
                    .easing( TWEEN.Easing.Exponential.InOut )
                    .start();
            }
            new TWEEN.Tween( this )
                .to( {}, duration * 2 )
                .onUpdate( render )
                .start();
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
            render();
        }
        
        function animate() {
            requestAnimationFrame( animate );
            TWEEN.update();
            controls.update();
        }
        
        function render() {
            renderer.render( scene, camera );
        }
    </script>
</body>
</html>